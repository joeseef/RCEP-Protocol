<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>RL4 Snapshot</title>
  <link rel="stylesheet" href="styles/popup.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="header-brand">
        <div class="logo-wrap" aria-hidden="true">
          <img src="icons/logo.png" alt="RL4 Logo" class="logo-img" />
        </div>
        <div class="header-text">
          <h1>RL4 Snapshot</h1>
          <p class="subtitle">RCEPâ„¢ context â€¢ Claude + ChatGPT + Gemini â€¢ Save context â†’ reuse anywhere</p>
        </div>
      </div>
      <div class="header-actions">
        <button id="reloadBtn" class="btn-inline btn-reload" type="button" title="Reset UI for a new run">
          Reload
        </button>
        <!-- Busy indicator (top-right) -->
        <div id="busySpinner" class="busy-spinner hidden" aria-hidden="true"></div>
      </div>
    </header>
    
    <main>
      <div class="field">
        <label class="field-label" for="urlInput">Conversation link (optional)</label>
        <input id="urlInput" class="input" type="text" placeholder="Paste a Claude / ChatGPT / Gemini conversation URL" />
      </div>

      <div id="optionsWrap" class="options">
        <div class="options-head">
          <span class="options-title">Options</span>
          <button id="optionsToggleBtn" class="btn-inline btn-toggle" type="button" aria-expanded="false">
            Show
          </button>
        </div>
        <div id="optionsBody" class="options-body hidden">
          <label class="checkbox">
            <input id="ultraCompress" type="checkbox" checked />
            <span><strong>Compact</strong> (recommended) â€” fits most LLMs</span>
          </label>

          <label class="checkbox">
            <input id="semanticHints" type="checkbox" checked />
            <span><strong>Compact + Meaning</strong> (Ultra+) â€” adds a tiny summary & checklist (no transcript)</span>
          </label>

          <label class="checkbox">
            <input id="includeTranscript" type="checkbox" />
            <span><strong>Full transcript</strong> â€” best fidelity, can be too large</span>
          </label>

          <label class="checkbox">
            <input id="integritySeal" type="checkbox" checked />
            <span><strong>Tamper Seal</strong> (deviceâ€‘only) â€” detects edits after export</span>
          </label>
        </div>
      </div>

      <button id="generateBtn" class="btn-primary">
        Generate Context
      </button>

      <div id="status" class="status hidden"></div>
      
      <div id="metadata" class="metadata hidden">
        <div class="stat">
          <span class="label">Messages:</span>
          <span id="messageCount">-</span>
        </div>
        <div class="stat">
          <span class="label">Compression:</span>
          <span id="compressionRatio">-</span>
        </div>
        <div class="stat">
          <span class="label">Checksum:</span>
          <span id="checksum" class="checksum-short">-</span>
        </div>
      </div>

      <div id="postActions" class="hidden">
        <div class="separator">__</div>

        <button id="copyEncoderPromptBtn" class="btn-primary" type="button">
          Create finalization prompt
        </button>

        <div id="rl4BlocksManual" class="hidden">
          <div class="field" style="margin-top: 8px;">
            <label class="field-label" for="rl4BlocksInput">Paste LLM response here</label>
            <textarea id="rl4BlocksInput" class="input" rows="6" placeholder="Paste the assistant reply containing <RL4-ARCH>â€¦</RL4-ARCH> etc."></textarea>
          </div>
          <button id="finalizeBlocksBtn" class="btn-secondary" type="button">
            Finalize Snapshot
          </button>
        </div>

        <button id="copyPromptBtn" class="btn-secondary" type="button" disabled>
          Copy Final Snapshot (into another LLM)
        </button>

        <a href="#" id="viewRawBtn" class="link-subtle">View raw JSON</a>
      </div>

      <!-- Persistent "last prompt" (survives popup close/reopen) -->
      <div id="lastPrompt" class="last-prompt hidden">
        <div class="last-prompt-head">
          <span class="last-prompt-title">Last prompt</span>
          <button id="toggleLastPromptBtn" class="btn-inline btn-toggle" type="button" aria-expanded="false">
            Show
          </button>
          <button id="copyLastPromptBtn" class="btn-inline" type="button">ðŸ“‹ Copy</button>
        </div>
        <pre id="lastPromptText" class="last-prompt-text"></pre>
      </div>
    </main>
    
    <footer>
      <span class="link-subtle">Crossâ€‘LLM context, made simple.</span>
    </footer>
  </div>
  
  <script src="lib/checksum.js"></script>
  <script src="lib/extraction.js"></script>
  <script src="lib/snapshot.js"></script>
  <script src="popup.js"></script>
</body>
</html>

